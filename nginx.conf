server {
    listen 80;
    listen [::]:80;
    server_name jacobz.xyz www.jacobz.xyz;
    
    # Corrected root path for Windows
    root "C:/Users/Jacob/AWBB/"; 
    
    index index.php index.html index.htm;

    # This is the most crucial part for your application
    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    # Pass PHP scripts to PHP-FPM
    location ~ \.php$ {
        # Check if the file exists before passing to php-fpm
        try_files $uri =404;
        
        # This is where you configure the connection to PHP-FPM
        # Use a TCP port for Windows
        fastcgi_pass 127.0.0.1:9000;
        
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    # Hide dotfiles like .htaccess and .git
    location ~ /\. {
        deny all;
    }

    # Set appropriate headers for static files
    location ~* \.(jpg|jpeg|png|gif|bmp|webp|svg|mp4|webm|ogg|mov|avi|mp3|wav|pdf|txt|log|md|php|html|css|js|json|xml|csv|py|bat|cmd|sh|c|cpp|h|hpp|java|cs|go|rb|pl|swift|kt|rs|ts|jsx|tsx|vue|scss|less|jsonc|yaml|yml|toml|ini|cfg)$ {
        expires 30d;
        add_header Cache-Control "public, no-transform";
    }

    # Redirect non-www to www (optional)
    if ($host = 'jacobz.xyz') {
        return 301 https://www.jacobz.xyz$request_uri;
    }
}